# GitHub Actions è§†é¢‘è‡ªåŠ¨åŒ–å·¥ä½œæµ - 2025å¹´8æœˆæœ€æ–°ç‰ˆ
name: ğŸ¥ æ™ºèƒ½è§†é¢‘è‡ªåŠ¨åŒ–å·¥ä½œæµ 2025

on:
  schedule:
    - cron: '0 9 * * *'  # æ¯å¤©ä¸Šåˆ9ç‚¹æ‰§è¡Œ
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      video_topic:
        description: 'è§†é¢‘ä¸»é¢˜'
        required: false
        default: 'æ—¥å¸¸ç§‘æŠ€èµ„è®¯'
        type: string
      video_length:
        description: 'è§†é¢‘æ—¶é•¿(ç§’)'
        required: false
        default: '300'
        type: string
      ai_model:
        description: 'AIæ¨¡å‹é€‰æ‹©'
        required: false
        default: 'gpt-4o'
        type: choice
        options:
        - gpt-4o
        - claude-3.5-sonnet
        - gemini-pro

# 2025å¹´æ–°å¢ï¼šOIDCæƒé™é…ç½®
permissions:
  id-token: write
  contents: read
  actions: read
  security-events: write

jobs:
  video-automation:
    runs-on: ubuntu-24.04  # 2025å¹´LTSç‰ˆæœ¬
    
    # 2025å¹´æ–°å¢ï¼šç¯å¢ƒé…ç½®
    environment:
      name: production
      url: ${{ steps.deploy.outputs.page_url }}
    
    steps:
    - name: ğŸš€ æ£€å‡ºä»£ç  (checkout@v5)
      uses: actions/checkout@v5
      with:
        fetch-depth: 0
        lfs: true
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ (Python 3.12)
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'
        
    - name: ğŸ”§ ç¼“å­˜ä¾èµ–
      uses: actions/cache@v4
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
          
    - name: ğŸ“¦ å®‰è£…ä¾èµ– (2025å¹´æœ€æ–°ç‰ˆæœ¬)
      run: |
        pip install --upgrade pip
        pip install openai>=1.35.0
        pip install moviepy>=2.0.0
        pip install google-api-python-client>=2.100.0
        pip install google-auth>=2.25.0
        pip install pillow>=10.0.0
        pip install numpy>=1.25.0
        pip install ffmpeg-python>=0.2.0
        pip install requests>=2.31.0
        
    - name: ğŸ¤– ç”Ÿæˆè§†é¢‘è„šæœ¬ (GPT-4o)
      run: python scripts/generate_script.py
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        VIDEO_TOPIC: ${{ github.event.inputs.video_topic || 'æ—¥å¸¸ç§‘æŠ€èµ„è®¯' }}
        AI_MODEL: ${{ github.event.inputs.ai_model || 'gpt-4o' }}
        
    - name: ğŸ¬ åˆ›å»ºæ™ºèƒ½è§†é¢‘
      run: python scripts/create_video.py
      env:
        VIDEO_LENGTH: ${{ github.event.inputs.video_length || '300' }}
        ELEVEN_LABS_API_KEY: ${{ secrets.ELEVEN_LABS_API_KEY }}
        
    - name: ğŸ“¤ ä¸Šä¼ åˆ°YouTube (API v4)
      run: python scripts/upload_youtube.py
      env:
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
        YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
        
    - name: ğŸ’¾ ä¸Šä¼ ç”Ÿæˆç»“æœ
      uses: actions/upload-artifact@v4
      with:
        name: generated-videos-${{ github.run_number }}
        path: |
          output/
          logs/
        retention-days: 30
